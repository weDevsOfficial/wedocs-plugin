(()=>{"use strict";var e={533:(e,t,o)=>{o.d(t,{A:()=>r});var n=o(609);const r=(0,n.createElement)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 22 18",fill:"none"},(0,n.createElement)("path",{d:"M20.3574 0.120361C21.0356 0.120379 21.5839 0.668752 21.584 1.34692C21.584 1.84677 21.2856 2.27474 20.8574 2.46606V6.36353C21.5099 6.66256 21.9503 7.20505 21.9961 8.0481C21.9985 8.09871 22 8.67906 22 8.72974C22 8.77621 21.999 9.60227 21.999 9.65161C21.931 10.9279 20.9632 11.5184 19.7197 11.6145C18.9403 15.5822 15.3332 17.8801 10.999 17.8801C6.66363 17.8801 3.05521 15.5812 2.27637 11.6116C1.03483 11.4955 0.0707824 10.8026 0.00390625 9.52954C0.00145752 9.48179 0 8.77749 0 8.72974C1.39541e-06 8.68032 0.00145892 8.21911 0.00390625 8.17017C0.0497323 7.32686 0.489827 6.73982 1.14258 6.40552V2.46606C0.715048 2.27453 0.416016 1.84641 0.416016 1.34692C0.416151 0.669965 0.966565 0.120361 1.64355 0.120361C2.32161 0.120549 2.86998 0.668858 2.87012 1.34692C2.87012 1.84713 2.57124 2.27592 2.14258 2.46704V6.10571C2.20844 6.09723 2.27527 6.0913 2.34277 6.08618C3.24165 2.30043 6.77492 0.120405 11 0.120361C15.2243 0.120361 18.7565 2.29975 19.6562 6.08423C19.7241 6.08853 19.7912 6.0936 19.8574 6.10083V2.46606C19.4296 2.27466 19.1309 1.84662 19.1309 1.34692C19.131 0.669966 19.6804 0.120361 20.3574 0.120361ZM11.001 2.0686C7.3014 2.0686 4.27893 4.20979 4.0791 7.85962C4.07241 7.98673 4.06836 8.8722 4.06836 9.00122C4.06836 9.12651 4.07144 10.0059 4.07812 10.1282C4.27139 13.7836 7.29669 15.9319 11 15.9319C14.7032 15.9318 17.7286 13.7835 17.9209 10.1282C17.9285 10.0059 17.9326 9.12651 17.9326 9.00122C17.9326 8.8722 17.9286 7.98673 17.9219 7.85962C17.722 4.20989 14.7004 2.06871 11.001 2.0686ZM7.89746 6.43677C8.61856 6.43677 9.20299 7.02136 9.20312 7.74243C9.20312 8.46362 8.61865 9.0481 7.89746 9.0481C7.17631 9.04806 6.5918 8.4636 6.5918 7.74243C6.59193 7.02138 7.17639 6.43681 7.89746 6.43677ZM14.0977 6.43677C14.8195 6.43692 15.4032 7.0206 15.4033 7.74243C15.4033 8.46437 14.8196 9.04794 14.0977 9.0481C13.3756 9.0481 12.792 8.46446 12.792 7.74243C12.7921 7.02051 13.3757 6.43677 14.0977 6.43677Z",fill:"currentColor"}))},609:e=>{e.exports=window.React}},t={};function o(n){var r=t[n];if(void 0!==r)return r.exports;var s=t[n]={exports:{}};return e[n](s,s.exports,o),s.exports}o.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return o.d(t,{a:t}),t},o.d=(e,t)=>{for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);const n=window.wp.plugins;var r=o(533),s=o(609);const a=window.wp.i18n,i=window.wp.element,c=window.wp.data,l=window.wp.editor,d=window.wp.coreData,p=window.wp.components,u=window.wp.editPost,m=window.wp.blockEditor,g=window.wp.blocks,w=({content:e,onAccept:t,onReject:o,onClose:n})=>(0,s.createElement)(p.__experimentalVStack,{spacing:4},(0,s.createElement)(p.Card,null,(0,s.createElement)(p.CardBody,null,(0,s.createElement)("div",{dangerouslySetInnerHTML:{__html:e},style:{border:"1px solid #ddd",padding:"16px",borderRadius:"4px",backgroundColor:"#f9f9f9",maxHeight:"400px",overflowY:"auto"}}))),(0,s.createElement)(p.Notice,{status:"info",isDismissible:!1},(0,a.__)("The content above is formatted with HTML tags. When inserted, it will be properly formatted in your document.","wedocs")),(0,s.createElement)(p.__experimentalHStack,{justify:"flex-end",spacing:2},(0,s.createElement)(p.Button,{variant:"tertiary",onClick:n},(0,a.__)("Cancel","wedocs")),(0,s.createElement)(p.Button,{variant:"secondary",onClick:o},(0,a.__)("Reject & Try Again","wedocs")),(0,s.createElement)(p.Button,{variant:"primary",onClick:t},(0,a.__)("Accept & Insert","wedocs")))),h=new class{constructor(){this.providers=window.weDocsEditorVars?.aiProviderConfigs||{},this.providers=wp.hooks.applyFilters("wedocs_ai_service_providers",this.providers)}async getAiSettings(){try{const e=await fetch("/wp-json/wp/v2/docs/settings?data=wedocs_settings"),t=await e.json();return t?.ai||this.getDefaultAiSettings()}catch(e){return this.getDefaultAiSettings()}}getDefaultAiSettings(){const e={};return Object.keys(this.providers).forEach((t=>{const o=this.providers[t],n=Object.keys(o.models),r=n[0];e[t]={api_key:"",models:n,selected_model:r}})),{default_provider:"openai",providers:e}}async testApiConnection(e,t,o=null){try{if(!this.providers[e])throw new Error((0,a.__)("Invalid provider specified","wedocs"));if(!t)throw new Error((0,a.__)("API key is required","wedocs"));const n=this.getTestPayload(e),r=await this.makeApiCall(e,t,o,n);return{success:!0,message:(0,a.__)("API connection successful","wedocs"),response:r}}catch(e){return{success:!1,message:e.message||(0,a.__)("API connection failed","wedocs"),error:e}}}async generateContent(e,t={}){try{const o=await this.getAiSettings(),{provider:n=o.default_provider,model:r=null,feature:s="ai_doc_writer"}=t,i=o.providers[n];if(!i)throw new Error((0,a.__)("AI provider not configured","wedocs"));const c=r||i.selected_model,l="/wp-json/wp/v2/docs/ai/generate",d=window.weDocsEditorVars?.nonce||"",p={prompt:e,provider:n,model:c,maxTokens:t.maxTokens||2e3,temperature:t.temperature||.7,systemPrompt:t.systemPrompt||(0,a.__)("You are a helpful documentation assistant.","wedocs")},u=await fetch(l,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json","X-WP-Nonce":d},body:JSON.stringify(p)});if(!u.ok){let e={},t=(0,a.__)("AI content generation failed. Please try again.","wedocs");try{const o=await u.text();o.trim().startsWith("{")?(e=JSON.parse(o),t=e.message||e.code||t,(t.includes("<p>")||t.includes("critical error"))&&(t=(0,a.__)("A server error occurred. Please try again or contact support if the problem persists.","wedocs"))):t=500===u.status?(0,a.__)("A server error occurred. Please try again.","wedocs"):403===u.status?(0,a.__)("You do not have permission to perform this action.","wedocs"):(0,a.__)("An error occurred. Please try again.","wedocs")}catch(e){t=500===u.status?(0,a.__)("A server error occurred. Please try again.","wedocs"):(0,a.__)("An error occurred. Please try again.","wedocs")}throw new Error(t)}const m=await u.json();return{content:m.content||"",usage:m.usage||null}}catch(e){throw e}}async listGoogleModels(e){try{const t=`https://generativelanguage.googleapis.com/v1beta/models?key=${e}`,o=await fetch(t,{method:"GET",headers:{"Content-Type":"application/json"}});if(!o.ok){const e=await o.json().catch((()=>({})));throw new Error(e.error?.message||e.message||(0,a.__)("Failed to list Google models","wedocs"))}return await o.json()}catch(e){throw e}}getTestPayload(e){const t={openai:{model:"gpt-3.5-turbo",messages:[{role:"user",content:"Hello"}],max_tokens:10},anthropic:{model:"claude-3-haiku-20240307",max_tokens:10,messages:[{role:"user",content:"Hello"}]},google:{contents:[{parts:[{text:"Hello"}]}]}};return t[e]||t.openai}preparePayload(e,t,o,n={}){const r={openai:{model:t,messages:[{role:"system",content:n.systemPrompt||(0,a.__)("You are a helpful documentation assistant.","wedocs")},{role:"user",content:o}],max_tokens:n.maxTokens||2e3,temperature:n.temperature||.7},anthropic:{model:t,max_tokens:n.maxTokens||2e3,messages:[{role:"user",content:`${n.systemPrompt||(0,a.__)("You are a helpful documentation assistant.","wedocs")}\n\n${o}`}]},google:{contents:[{parts:[{text:`${n.systemPrompt||(0,a.__)("You are a helpful documentation assistant.","wedocs")}\n\n${o}`}]}],generationConfig:{maxOutputTokens:n.maxTokens||2e3,temperature:n.temperature||.7}}};return r[e]||r.openai}async makeApiCall(e,t,o,n,r=null){const s=this.extractOptionsFromPayload(e,n),i=window.weDocsEditorVars?.nonce||"",c=await fetch("/wp-json/wp/v2/docs/ai/generate",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json","X-WP-Nonce":i},body:JSON.stringify({prompt:s.prompt,provider:e,model:r||s.model,maxTokens:s.maxTokens||2e3,temperature:s.temperature||.7,systemPrompt:s.systemPrompt})});if(!c.ok){let e={},t=(0,a.__)("API request failed","wedocs");try{const o=await c.text();o.trim().startsWith("{")?(e=JSON.parse(o),t=e.message||e.code||t):t=`HTTP ${c.status}: ${c.statusText}`}catch(e){t=`HTTP ${c.status}: ${c.statusText}`}throw new Error(t)}return await c.json()}extractOptionsFromPayload(e,t){switch(e){case"openai":return{prompt:t.messages?.find((e=>"user"===e.role))?.content||"",systemPrompt:t.messages?.find((e=>"system"===e.role))?.content||"",model:t.model,maxTokens:t.max_tokens,temperature:t.temperature};case"anthropic":const e=(t.messages?.[0]?.content||"").split("\n\n");return{prompt:e.slice(1).join("\n\n")||e[0]||"",systemPrompt:e[0]||"",model:t.model,maxTokens:t.max_tokens,temperature:t.temperature};case"google":const o=(t.contents?.[0]?.parts?.[0]?.text||"").split("\n\n");return{prompt:o.slice(1).join("\n\n")||o[0]||"",systemPrompt:o[0]||"",model:null,maxTokens:t.generationConfig?.maxOutputTokens,temperature:t.generationConfig?.temperature};default:return{prompt:"",systemPrompt:"",model:null,maxTokens:2e3,temperature:.7}}}parseResponse(e,t){switch(e){case"openai":case"anthropic":return{content:t.content?.[0]?.text||"",usage:t.usage||null};case"google":return{content:t.candidates?.[0]?.content?.parts?.[0]?.text||"",usage:t.usageMetadata||null};default:return{content:"",usage:null}}}getProviderModels(e){return this.providers[e]?.models||{}}validateAiSettings(e){const t=[];return e.default_provider||t.push((0,a.__)("Default provider is required","wedocs")),this.providers[e.default_provider]||t.push((0,a.__)("Invalid default provider","wedocs")),Object.entries(e.providers||{}).forEach((([e,o])=>{o.api_key&&!this.providers[e]&&t.push(`${e}: ${(0,a.__)("Invalid provider","wedocs")}`)})),{isValid:0===t.length,errors:t}}},_=({isOpen:e,onClose:t})=>{const[o,n]=(0,i.useState)(""),[r,d]=(0,i.useState)(""),[u,_]=(0,i.useState)(""),[y,f]=(0,i.useState)(!1),[k,v]=(0,i.useState)(!0),[C,x]=(0,i.useState)(!1),[P,b]=(0,i.useState)(""),[T,E]=(0,i.useState)(!1),[A,S]=(0,i.useState)(""),{insertBlocks:I,replaceBlocks:B,insertDefaultBlock:M}=(0,c.useDispatch)(m.store),{editPost:O}=(0,c.useDispatch)(l.store),H=(0,c.useSelect)((e=>{const{getCurrentPost:t,getEditedPostContent:o}=e("core/editor"),{getSelectedBlockClientId:n,getBlocks:r,getSelectedBlock:s,getBlockInsertionPoint:a,getBlockOrder:i}=e("core/block-editor");return{post:t(),content:o(),selectedBlockClientId:n(),blocks:r(),selectedBlock:s(),insertionPoint:a(),blockOrder:i()}}),[]),{currentPost:j,selectedBlockId:D,blocks:N,cursorPosition:V}=(0,i.useMemo)((()=>{const e=H.post,t=H.content,o=H.selectedBlockClientId,n=H.blocks||[],r=H.selectedBlock,s=H.insertionPoint,a=H.blockOrder||[];return{currentPost:{id:e?.id||null,title:e?.title||"",contentRaw:t||"",contentRendered:t||""},selectedBlockId:o||null,blocks:n,cursorPosition:{selectedBlock:r,insertionPoint:s,blockOrder:a,hasSelection:!!o,selectedBlockIndex:r?a.indexOf(r.clientId):-1}}}),[H]);(0,i.useEffect)((()=>{j?.title&&!o&&n(j.title)}),[j]),(0,i.useEffect)((()=>{const e=((e,t)=>{if(!e&&!t)return(0,a.__)("Generate documentation using HTML heading tags for the title. Include details on {Documentation Keywords} and wrap all content in <p> tags. Highlight headings and keywords with <span class='highlight'>.","wedocs");let o=(0,a.__)("Generate documentation using HTML heading tags for '{title}'. Include relevant details on {keywords} in the documentation. Wrap all content in <p> tags. Highlight headings and keywords with <span class='highlight'>.","wedocs");return o=e?o.replace("{title}",e):o.replace("for '{title}'","for the title"),o=t?o.replace("{keywords}",t):o.replace("Include relevant details on {keywords} in the documentation.","Include relevant details in the documentation."),o})(o,u);d(e)}),[o,u]);const G=()=>{E(!1),b(""),S(""),t()};return(0,s.createElement)(p.Modal,{title:(0,a.__)("AI Doc Writer","wedocs"),onRequestClose:G,className:"wedocs-ai-doc-writer-modal",size:"large"},T?(0,s.createElement)(w,{content:P,onAccept:()=>{try{const e=(e=>{const t=[],o=(n=e)?n=(n=(n=(n=n.replace(/<script[^>]*>.*?<\/script>/gi,"")).replace(/href\s*=\s*(["\'])\s*javascript:.*?\1/gi,'href="#"')).replace(/\s+on\w+\s*=\s*(["\'])?[^"\']*\1?/gi,"")).replace(/javascript\s*:/gi,""):n;var n;const r=document.createElement("div");return r.innerHTML=o,Array.from(r.children).forEach((e=>{const o=e.tagName.toLowerCase();switch(o){case"h1":case"h2":case"h3":case"h4":case"h5":case"h6":const n=parseInt(o.charAt(1));t.push((0,g.createBlock)("core/heading",{content:e.innerHTML,level:n}));break;case"p":t.push((0,g.createBlock)("core/paragraph",{content:e.innerHTML}));break;case"ul":case"ol":const r="ul"===o?"ul":"ol",s=Array.from(e.querySelectorAll("li")).map((e=>e.innerHTML));t.push((0,g.createBlock)("core/list",{values:s,ordered:"ol"===r}));break;case"blockquote":t.push((0,g.createBlock)("core/quote",{value:e.innerHTML}));break;default:t.push((0,g.createBlock)("core/html",{content:e.outerHTML}))}})),0===t.length&&t.push((0,g.createBlock)("core/paragraph",{content:e})),t})(P);if(y){const t=N.map((e=>e.clientId)).filter((e=>e));t.length>0?B(t,e):I(e)}else{const t=wp.data.select("core/block-editor").getBlocks(),o=[...t,...e],n=t.map((e=>e.clientId));wp.data.dispatch("core/block-editor").replaceBlocks(n,o)}t()}catch(e){S((0,a.__)("Failed to insert content. Please try again.","wedocs"))}},onReject:()=>{E(!1),b("")},onClose:G}):(0,s.createElement)(p.__experimentalVStack,{spacing:4},(0,s.createElement)(p.Card,null,(0,s.createElement)(p.CardBody,null,(0,s.createElement)(p.__experimentalVStack,{spacing:3},(0,s.createElement)(p.TextControl,{label:(0,a.__)("Documentation Title","wedocs"),value:o,onChange:n,placeholder:(0,a.__)("Enter your documentation title here...","wedocs"),help:(0,a.__)("The title will be used to generate relevant content.","wedocs"),__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0}),(0,s.createElement)(p.TextControl,{label:(0,a.__)("Keywords","wedocs"),value:u,onChange:_,placeholder:(0,a.__)("Add keywords to guide AI (comma-separated)...","wedocs"),help:(0,a.__)("Enter relevant keywords separated by commas.","wedocs"),__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0}),(0,s.createElement)(p.TextareaControl,{label:(0,a.__)("AI Instructions","wedocs"),value:r,onChange:d,rows:4,placeholder:(0,a.__)("AI instructions will be auto-generated from title and keywords...","wedocs"),help:(0,a.__)("Instructions are automatically generated from your title and keywords. You can edit them manually if needed.","wedocs"),__nextHasNoMarginBottom:!0}),(0,s.createElement)(p.ToggleControl,{label:(0,a.__)("Use existing post content","wedocs"),checked:k,onChange:v,help:(0,a.__)("When enabled, the AI will consider your existing post content to maintain consistency and avoid duplication.","wedocs"),__nextHasNoMarginBottom:!0}),(0,s.createElement)(p.ToggleControl,{label:(0,a.__)("Overwrite your existing Doc","wedocs"),checked:y,onChange:f,help:(0,a.__)("When enabled, AI content will replace the entire document. When disabled, content will be inserted at the end of the current contents.","wedocs"),__nextHasNoMarginBottom:!0})))),A&&(0,s.createElement)(p.Notice,{status:"error",isDismissible:!1},A),(0,s.createElement)(p.__experimentalHStack,{justify:"flex-end",spacing:2},(0,s.createElement)(p.Button,{variant:"secondary",onClick:G},(0,a.__)("Cancel","wedocs")),(0,s.createElement)(p.Button,{variant:"primary",onClick:async()=>{if(o.trim())if(u.trim()){S(""),x(!0);try{const t=await h.getAiSettings();if(!t.providers[t.default_provider]?.api_key)return void S((0,a.__)("AI service is not configured. Please set up your AI provider settings in weDocs > Settings > AI Control Settings.","wedocs"));let o=(0,a.__)('You are a professional documentation writer. Generate comprehensive, well-structured documentation content using HTML tags. Use proper heading hierarchy (h2, h3, etc.) and wrap all content in paragraph tags. Highlight important terms with <span class="highlight"> tags. IMPORTANT: Only return the content body without HTML document structure (no <!DOCTYPE>, <html>, <head>, <style>, or <body> tags). Return only the content that should be inserted into the document.',"wedocs"),n=r;k&&j?.contentRaw&&(n=`${(0,a.__)("EXISTING DOCUMENT CONTEXT:\n{content}\n\nPlease generate new content that complements and builds upon the existing content above. Maintain consistency in tone, style, and structure. Avoid duplicating information already covered.","wedocs").replace("{content}",j.contentRaw)}\n\n${r}`,o+=" "+(0,a.__)("Consider the existing document content provided above to maintain consistency and avoid duplication.","wedocs"));const s=t.providers[t.default_provider].selected_model,i=await h.generateContent(n,{provider:t.default_provider,model:s,feature:"ai_doc_writer",systemPrompt:o,maxTokens:2e3,temperature:.7});if(!i.content)throw new Error((0,a.__)("AI service returned empty content","wedocs"));const c=(e=i.content)?e.replace(/```html\s*/gi,"").replace(/```\s*/g,"").replace(/<!DOCTYPE[^>]*>/gi,"").replace(/<html[^>]*>/gi,"").replace(/<\/html>/gi,"").replace(/<head[^>]*>[\s\S]*?<\/head>/gi,"").replace(/<body[^>]*>/gi,"").replace(/<\/body>/gi,"").replace(/<style[^>]*>[\s\S]*?<\/style>/gi,"").replace(/<title[^>]*>[\s\S]*?<\/title>/gi,"").replace(/<meta[^>]*>/gi,"").trim():e,l=(e=>{const t=[];if(!e||0===e.trim().length)return t.push((0,a.__)("Generated content is empty.","wedocs")),{isValid:!1,errors:t};const o=/<p[^>]*>.*?<\/p>/i.test(e),n=/<h[1-6][^>]*>.*?<\/h[1-6]>/i.test(e);o||n||t.push((0,a.__)("Generated content should contain at least paragraphs or headings.","wedocs"));const r=[/<script[^>]*>.*?<\/script>/gi,/<iframe[^>]*>.*?<\/iframe>/gi,/javascript:/gi,/on\w+\s*=/gi];for(const o of r)if(o.test(e)){t.push((0,a.__)("Generated content contains potentially unsafe HTML elements.","wedocs"));break}const s=e.replace(/<[^>]*>/g,"").trim();return s.length<50&&t.push((0,a.__)("Generated content is too short. Please try again with more specific keywords.","wedocs")),s.length>1e4&&t.push((0,a.__)("Generated content is too long. Please try again with more focused keywords.","wedocs")),{isValid:0===t.length,errors:t}})(c);if(!l.isValid)return void S(l.errors.join(" "));b(c),E(!0)}catch(e){S(e.message||(0,a.__)("Failed to generate content. Please try again.","wedocs"))}finally{x(!1)}var e}else S((0,a.__)("Please enter keywords to guide the AI.","wedocs"));else S((0,a.__)("Please enter a documentation title.","wedocs"))},disabled:C},C?(0,s.createElement)(s.Fragment,null,(0,s.createElement)(p.Spinner,null),(0,a.__)("Generating...","wedocs")):(0,a.__)("Generate Content","wedocs")))))};(0,n.registerPlugin)("wedocs-ai-doc-writer",{icon:r.A,render:()=>{const[e,t]=(0,i.useState)(!1),{isViewable:o,postTypeName:n}=(0,c.useSelect)((e=>{const t=e(l.store).getCurrentPostType(),o=e(d.store).getPostType(t);return{isViewable:o?.viewable,postTypeName:t}}),[]);return o&&"docs"===n?(0,s.createElement)(i.Fragment,null,(0,s.createElement)(u.PluginSidebarMoreMenuItem,{target:"wedocs-ai-doc-writer",icon:r.A},(0,a.__)("AI Doc Writer","wedocs")),(0,s.createElement)(u.PluginSidebar,{name:"wedocs-ai-doc-writer",title:(0,a.__)("AI Doc Writer","wedocs")},(0,s.createElement)("div",{style:{padding:"16px"}},(0,s.createElement)("p",{style:{marginBottom:"16px",fontSize:"14px",color:"#666"}},(0,a.__)("Generate AI-powered documentation content with advanced language models.","wedocs")),(0,s.createElement)(p.Button,{onClick:()=>t(!0),variant:"primary",style:{width:"100%",height:"40px",fontSize:"14px",fontWeight:"500",backgroundColor:"#4338CA",borderColor:"#4338CA"}},(0,a.__)("Open AI Doc Writer","wedocs")))),e&&(0,s.createElement)(_,{isOpen:e,onClose:()=>t(!1)})):null}})})();